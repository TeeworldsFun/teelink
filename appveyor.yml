image: Visual Studio 2015

environment:
  HCLIENT_VERSION: 4.0.2
  SEC_FILE:
    secure: i3RUJdoatP38GAQONDvVT9VuXi+qjdI1KhiURT77OmI9IPPgGO4MqTdlCvhBaT9bQxRfESqHYR5HxCmSn+UlvCc+mw8SjaNNiZfgy8M4AfvQZt2gszRimIeL0WMSN9uvxv68F9fcr3MvKsJmH7YpqzTG6yXbNiOdyC2eBq68MzUqUkLimTmTD4fyt0sN20sxM2CFvZxrb1YThAFiKCmmtGfeWHz/1qUvsxrqoiOhbNFoLHGJnhoNAuDyt50qIB2B3Vp14LD2SHYDqEOhqchNSS9kkKi5/TEs3t2/B8/yz+gMz2hA9OK2uxsiPl1stHj2LnkXtw+9qZDp8buDwOaCBphth+qfkC0FUbfaJPbPFT55p7ngQIblV9EY/GFBT/oPtDFuZCIzYaE38ZHHm7O8C6yEthHqayKQD4C5vm78WuTxQcTOIuvwDtX7ExaB/y+QTvVI+rYe7jYhk8SFyvPE27oT3lKwd9VZJ4kKv8qOwVzFi62a+JxBRYs15Rkcf6QvxcLADaDKgE4WfKQvWKrfH1GEzSiH6x/AllzLFa5Gc3vG5WqZhC83yZ13JPoRTJ6DsCd1VbUnaD6e/3QupJx6jZMm5tmqGvyGXGfuzSc1DEGUjVhDUF2z9vd4HBqBbhPMjwSVlQHrC1LDbbOeEZV3jz6jncOA2/OV8dRlsq6EPNLCH8khMKV8ul8d73s1fGkQfQ/s836EYFfcOtqs2JTuXAdxgYjeGCJIFOlNRqodjrF1fFezyNH7KuecpfnT/E1z2qRDaGg5i23cmSpSGK7cRCa858HVL4JmkLeFmbZRhtWIt+AekESs0pViLlJux0gG34sbnqBy0jMgg3SYdBSV06Y4Le09FZ5/65uh8H5dRaa+DDt6pTFhDMuazNUejCzqL9xANHRIOiySEKK9O3qdm4toW0rq3/8hHDEQ5aCxJomwXWQKMwOSthzUqezZXKhDwKl5SSFYUlE9GiW2pIgdevnnfdNemwiymVODvJnWv40K3h2ekLZ+7zPje2GsirmNj8AjSumiPjdisi51PxS66+tGauTvCKPptL0uHz9UbvWw5lNmwtjyMbTrZaOxIia7iMQkrKZozQ4vkvYC8xM+s2wumLPCX3R13m3PF3+thvJnQNkijDhlGRZvDbUHsQPNAvEbo6ZlJs+eoUppJMjbIx1YQYmapqHaym+eePylJVrES65lnS4LxjvPGiD1EcKX8qts+b8i5EWTDp0yunyMLDWWohh0BfGHXDxHdhQzAFJbBybmj7/6vJ+HlcC8XR1g87KUANhU5gfSx8NwWqKaEhFmVfh7aHLJ7aI49VScx/LAT3r7C/WPzUuOQnV7t/+IjeC50ApJlo+Coq8sDe6AbNzzdrFwret/DIbObn4aNcXeVWfEZOJofWkMxDBwK55TVgNppOtNoPsPHcPvZiteEKf0biMTzsSjP0BUKtH2NrENH3gtNsw0p4bvtTr3otOmZcJ7J50CUcQFDqXkzvoaj9CvVbzX11NPAKAMGHI35wpPqQw3C3qxQPf46Uixg22xCjtxB3J88MtBIgDLSaoSoliQpBANnbyJtfQbtfRNCwDI5yuXFIyDIyFfTJziSLOhvNqhxR4jYOpIckNIr8Toa9l4po4Egp4+XAWCxJqQr419TmLXvn5bmC1DKtdAoBK6Sl6a9BiNsLmclt3LAhnkkD0ndFbFS1+JeQ06fkTev2voMDMjGB9+fTAHvMSeUd964HJ4hRKbhgcAF+Ck4M4GK84UqcBqlHk0YsvwtUm7F8RNagTjO2Tjteu1Z4P+K6z5DlTkmAins2abzgKTqH/In2piptvmKgw3uCni2B1nnjJtFulDZr+BgVg0rn2HkfS1G/jEKFRB+QiARW43Sqsq+GkcS/Eqwdpopgf4K+rMej9QRsjakmRZdOVslATnO3eMwpyF264hZMkv0jaJcbShHu0CiWBExzbMQl5Qzt+yIPkcgPq+rB6M6rYkbaXLsJTmWkZASs4XlggF4efDItZ6w9OS9hUGFDPw08fFuSXepjRZhuG86aWhbwsYGvWjvsOwXu/KlcUxOHWSlLCkMHmDLe5cmI+h+PLn8v0ZL4PW1zw20MQNKMHA6RMF9odF64ZIn3sG1LDYcdQxkLHyshV5HoO44dDB0GH6dC0jTWrdcLc866wm3wAG93HweOJnoCWmmdZK10U3FjrZVXtL9SgbnDay4H5YB0ekoY8gsGhLimK045sEjlKTRc2qfpP1v20d0VzKQgrRAKDtYH7dbiH6za3yjxrTXW4HrcgqtyGUXlJgIx7cPEMtZfsZ/ZqUjjOPVJUEeWZq5ZQuIbYBxUJJY2xdhll+5N2hjDUUBbuoAGqbzD/TduLI7DtUf6HBsgyqUN7uZ+2VvhqcKsjT9PuuTxQsiPg1eVWLf3UXQfDd9vPuWAlvCuskZ5xOkyNT2uKd4aZhJ0AhGwz1V1ur+d6pthzGlIg8C19ao5gGvL9YnaDIUM3tmeowSU7jkznvmvXSek32ASPSxg/qQf3vnLYU5MOv/H2oPpwlgAHrciqehs3f0qGEDUWxgyBb/+haiTomEYkbf9ypel9Ash5HbCXFMtdwGX+TzcQCiWEW5MP9dJTbFvFs/6Q32QVO9nEFUKWufW9IwFccvqAPynBNemCTbDJ1xtqze0yhkcv0/+VkWne4ZuII/tWOVfVRnawFGZ+C1jq6/5zfYJn15bR7B2fOEuI8VCw6khdYjlHqlR9oMeq92tw/bPL6BH1xaJMcsPztm9TQ4L4x1ETzmWldB4kB/g5tE/b2vV21wJiXVFuFTk54LjOQrcRWzCwAckp6gLJwqhVmnqkR6GO3GfZ6T3/va1aV6broy8QnZ1WSuk657M5k8szZhIk7GNgAWUBa40sXOm3d8qUbUg6d/NICcrdkCLroctV2Cb/e7jnxhN/mIt538Av3KAyAERAXcnnKk2L7YIBSnVW2ZjBde6oMwcSTAFzshS4FiYKx4qZV3NjDiY0zzRmdIbrP/s7UeIWlgzlAV3JLnCod+5cIMsCuIb1TkR3aT0E/9qGBJ0WNrhrDGElq+4fLKiGs+5vUnRCCnbwZF5h2PeFBz3mKVj2pzdowXPomioUxpEjhhPvnyr6ajqijEE/mBHjCIxd8WbeIbrUSo4QOk64r/nJewwCURpFVU+HYGE+O56dm7ZfArjDVt7R4Bx7dlZeHzCKXlxdrsWsIXit02hkhRf5BTi51P7uVB75JQ80pXxhpPzKLrnv0Dcn2CaR9VPzcJgQ1Slv2DsvhEgfCNEmdpe48Xja4Kv/gEpFiZy18tVeOUsNbmBlcxxZqDRVwulIXMV6tPGHndNFMhBxIM63V06jjbaOkmYxYKtSBz4OPGMV8QgV2EedEYs1Jn8/yVK4PQXfWKKYaZcUgg/raOjJdEVmyAex8zOtbAAyF49jnhQmXfKL4PVF8zWVHU0mmeqAkyHBP9OFekDaXtstYNEn2df9WpE8LLp6dowMeDyO2EevVM5BS4EV66KGmzjhlVlzQ32yi4TWJVRRzNUpbFg2MCmjx4PqsWCWNCT7WrUqrpDQ4OJ1HtqlLXzTNrrXbco13VpygMTkJ0uLwec9yD5CzwSmoCI3Do2nO+NyHk6rO7il2qkV/5JbIUmiNMrszG+o45/z5Yj92oeHIV33O/MIgilhxsk8+16pslAsf5VZoydOtENW4vLiA6ad920+LPzyBagE77B+1BYQLw9av+MJ+Oa8xbPAa7CQJYC595JvQf5cAAHv7mkQmdoU1fUu0cXhu/svU0Hcgbcla8+xTallwj6BokHPZWD9ZnWxZcs3ZbsnW5HGMPCk/Fuiio3FbyysMxW2IrDPSV2crGnS2WXGqK3PX6TixydBLMChbucDD6OVN9rWxdCQHo7ERyAjZ4CX5XwkZPLIepPm5vGjeyZuRzgT5c+LCb2IrvejHyYcA34LpPztRjsfR7nNVld6O/MpGCwiwn0NgarcOdOZdzxxxC+MoV9isTmVO+K//W4gWeRl/I9Pn9rmuPk8ghm3czYyTcqFG79KMpwySVwUD0QYoE/hFK4Smig6hPmcNCdCZPZ8uSLB/luky+R7kDQEWVX8BQOnXJDn8DJz8k+Y74oQh27i+FYktngexilU+vYXoct31NmngL+9/WTvi8+FHgv2BKzcL8EK3YP9DxFlHZkpDGq/D8Lnqb7HOIbdEINZrjzo6lRZJ7OXT8jajaxD37jRsFaN/RudSBBLnc8lXMenH0nBZSXwiQUZcUC537n5mlCtW+CZhSCkxWb0EVBhS/L0H6tqgzs2LcwfWPCvFbSDK5nhWYSIbVmEpM0PUqohlv6qT8hg3h/kID1zdaV1P15tsAFxb5ivEzrFDyfRnl4u/86BZRJ5DSxcyrsofHUf8kiQZ1nj1BaGFlO6UHbSZDg86y0WA1nC9WtHkDdMM0eAiePxQwbi+ZnrZ0TuCRhwkauFCmlr56UVPqhaxK5CNKdy4nH9XtjsGZggYuT2lHzr9GHHvbBTTzR7YEbYnS56DcAR5uJym0jJNjg/hvcCX7T9JDH1RBfWKwQnRgS6EolYhGicmhz+P0qUM+0UNJVHTeMEPmb44/e+iPlIZsEKj5GXagc1N9VveQhSX/0kUtIWyWqtZadRiNntSO4RRBV/JK1qM7w5Rvvx5QuRvj/D0hOnoXtlRCKVfvzAFHDZnNYxykLkY7gKRjSsSxjDbDnXSyguByb0/Ti/h7bEDaEjx/S+rnke6+FKopYliRWLvXsf5d1HGhBw2CaB8w3JJBG0AGgh+nf3RKJI7UoIQwK/2MoQ0PKDCocUkbKdR7O4C6GlKNPTAx/MQUTdugDq8QGOHZL5esdEtXBCGzYlH2dYKzhC/bCwAdUpN9IG38zDIVjeSjs3ToHT2g46aukTaEze269LRSMBnRktEDH7cpjkM+iyrZh+2VEQuTSKoCaXWwzbjQdMtN9bl1bji/EM3RjD2ktYIuqacraeByL1DUUnU0GH3NrVVRX3/oDbKllarpV9MG2nEHglQWp/lqMUBfgvXzKQP09LF5YWmLD500jyqdzAIEmyvXv6+N5d7PFTeKlzYUO+kg2dmcvTnVJ6A7iR0/14rRJfS/TqP4G6HpKAgWNKGkjtKqAv/1Raq80VJuLdRvkJFcOQJHXrc+UT3hDikuZDPCbJHncxw2js4GWXm+PnEpDtVfWQJTZsDkB4t9+Hxo8FUAbHZ1FVJOF907xOo13rEjgP9GB/TOSsMQb9Bso5d8yKk/kZp43tR80Ft1fIokESVEZYm+mtbKCf8rp++FWe+E3HARNfsMx0GJQUw2D5VMI0ItaerD+ml5TodmeV6qooJeFQlhYujCYyi+UELVTpLpz8VMtZXh3OhleBeRIuo24PTkJqr3Tws5NdSsJaqzX5tNuWEXM6jjolTRYYw8SX6kO+A1expv0KfSykflTox6KLrY7aR9az3LzbCeah2O1DWZ5f9YTkTxbPVDUS7cv5WLVZ9LpQ/9YN9Y5rhpE3W11OTGPRjCKLLlOcdCFU36zMBIKIGJ90ANlbHs0Ziio78+GXb+LzKYiPURk+Y94F+g2uUV141OVyZHQ3CjTMl89xQrM96oKAH91EqnsdkLXFPQMk9+iEks5kDWPtR0msmjE2Y9yBMzj1SSKCkcZYt7rkheMpQT52hVXKW4wQBFx5i3LBHFr9qgS+qh5UzDg+stVbwFNJG38ByTwfVqU05VwrWg31fqNR1kZ7s90Ow08BDJH1wuhfZgYXXc2N8c8emIxUtLa5nJbGjgbH1lintmreExjsjlo5uORncO9Cf0VDYLi7mal/vEnpEzvdFLplYod2Ocrw/Wsc/k5wG6Rvr1YDqUnIek4zhCh2qLb4lmQMJSJeLk6SBErfbdkiQ0DbpCocWTdtxgMCUf3wiF7/ItAZJhZZx2YlaO/uBl16ndkVlTR5zZfPUm32Rr5iiR21i+NGZBaEAdbDVw3J0WYdbFDItqU9t6laXjhxH3QUZenUKnKbhpC4T/nqxtHa42M8udJoR2Ayey0/5d1u4ELh0CfFtSSSNm7NnKUXACTdJDqC6gYc4pmrM/5yredy/ukiYlb3IiGeRxJRphRNWs/lib8x8ZfYvGTjCqf6mSkz/lIAJvgpVn3/ahsSP9y6Zd8CWYKp3U+AbYjaiJxgHIUxIMqWuphBvFbj3uknY4sZN5nGPb6lo9CQVJUpkfIewcAjMxh+9/fCogvUAUD/wE/CdF9UOyrtryFdRV9g5O0gZC/2iuF6LQcBLYerima+/LS4TlyDKhvPg83y3IfNDiBrjXkburwD9SjeNLqVm2zy90lovdglG536P6aVHGDGAxTOlQF18TbYQEMxCfiYa3WCAaJ5Qhw4lHnrV5NB07p/V66ktcAnD8Nd7v4UKuTthPil4RZZnqImCiQnOCK+BTnXqAmaD0eDhDSKqm0sSbJx937dZ67wHuR6ScjhveTJeAAy+F012H5CxZTQneoWTq7pTyMPGPpulnbwlAnJQu7oVX4D2Uzh+SCvaH+GS4YvBCRprh5iAI4jhjuP041ElFKhV2wktdoXMz1KkGh25Y5SMTLzDbA2akR7FRmNuom+sCT5xJls2Fn8ZZMN6J/ThNUXn5+7YoOJceSKxOpJahyq56coC7wJcUMFqNHvxhe1kH7mXTQNYHYueIx8pbawqyF5DUWc2jtKMlRy3PU/To7dC5SrSHMSwGVZQryRjXDp2dQ3xVgJKWH7j8pe8xHW9vrfKStVuXF/I3XNOblzd8rK4SPrkVnyrcKQkK5ETiHjHoKil9Dx7pg7V05YdVZgceH2X792uPlarhiwNViD0KC7TOnojDmPRyLIuAxEwKxLpZu2P2Z/PGXPZD17nQNPnuKLcZ4512kDyvoI+RMrigudTGb/vLe/PaLkwfWqPLw7EmrFUJ3/kOABw+nPnTUGADBBAic/+BRwYLw5tQBtrvy1NPq3EkCsBWFxCy7mOUw7090mJdhKHWcNPZfdUO07S3msqbGX/GLKEgeXA7gplIPJ9M1HniRJfwr5t3gJgL/WTi/+HQ2qDwalfNnKG1I4xFQUeOzhwB6qlaVFvGlKSWk3TCqkQaxhpm2g0pqWNOUwCrnFY5k3gQDldrjvKEi/HYMghkv4MsWDDpfi5BqzC7wQ/cvVZla1bgbUwaS3DouWgkFAWcZlrinb6JgzVEuzE5Sorme33vHLKgP18eSKrL2DsrUXhRFA3roQjkggYrugTVMO4lpQ9Inp8FtZQ5eS87WJF7vPoI6LWVgDcHcRqgT+X3KJornbTZCQTCAT11SIAbAhIPuUHGeJB9A87MFe70Z2hXChXPbiSwcNMJ53cEQlQmjWy671Zfv7C4MnByiwL7BhZtMoKOcfmZQPNgn6Ohotfd8pf5AjYWUL9Jns09pBsqOApjykgIgkrqQF2Afj4Grr2bdmPkxa1iR1/XgNfvMeK8SsNBxxABe5J5u9O94O4I6FqSn6y7Jov2G1z+/AJUEP0fV6jBVd01P+IePbW097nByZIlK2O9vscfc0Gmgk83yWzH/pcCBOToeY66QpCfmIPiS6OArEtxxF1
  SEC_FILE_PWD:
    secure: gCwxhetmQqSYDrlvLuehFtoy0Z/EHNavylqDnFsQQRg=


init:
  - cmd: call "C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat" x86
  
install:
  - IF NOT EXIST C:\projects\bam-0.5.0 (
    cd C:\projects &&
    curl -LfsS -o bam.zip https://github.com/matricks/bam/archive/v0.5.0.zip &&
    7z x bam.zip &&
    cd bam-0.5.0\ && 
    make_win64_msvc.bat &&
    cd C:\projects\hclient)
  - ps: Set-Content -Value "%SEC_FILE%" -Path .\sign_enc.pfx
  - certutil -decode .\sign_enc.pfx .\sign.pfx
      
cache:
  - C:\projects\bam-0.5.0

build_script:
  - cmd: ..\bam-0.5.0\bam.exe release
  - cmd: ..\bam-0.5.0\bam.exe debug
  
after_build:
  - signtool sign /tr http://timestamp.digicert.com /td sha256 /fd sha256 /f "sign.pfx" /p %SEC_FILE_PWD% "teeworlds.exe"
  - "SET PATH=C:\\Python27-x64;C:\\Python27-x64\\Scripts;%PATH%"
  - python scripts\make_release.py %HCLIENT_VERSION% win32
 
artifacts:
  - path: H-Client-*.zip
          teeworlds*.exe
          teeworlds*.pdb
    name: H-Client Win32
